language: node_js

node_js:
  - 4.2.3

env:
  global:
    - secure: rkjJxXaABx5tZzF0bYnLGO7/tAJII87Xucd+McrP12Es+ZxZgLbJ4Rb2rfTzeasMH4kzWXKE5xZCq46B4WG6LCVJHhk9NGNxVUEK6Ln6n39VB3p+NUP1cbPrDQBUPJ/Mjuykt7nnfr2us7u2vbhECcBjTFDUCdfYBtMHcAEXQfymRuvUG2btRTMLMPK6cVzWvNnkgLOSGmrhySEmHpMjyDHR0I6KNYMc0yh/B5NdB4vYPQfwT2RXAIUlQePRroLFQGS1z0u7kevNWa/S5lD/reBe6F68z4BzreJ5WowkuhfdsTp6AvPj1A6Z6+56kyTX1SFNRYJot61mXQLzywNwWA==
    - secure: CwimfCH/eT55L/mMPp/mSAmTKf9JdLB4fdN9QtA1FT8KX+lxarkvaIojNzkGQKcUdm6wxiQ6F7L3gvfw7OQ2IJ9kqChY8JCg50dzFQoBeDerbePR1c+Wt19GORnnHvZCytHkMd5K2xUI1PcvKquvfBoPMZbGJRpmG7TsHM6Glhge7xhGkS7B8kqmY7t71jdANGTN3PgFpWK5SCQk6mB9M2C2akhWEzk9LiZdkC633x3hV0RooNlSRlGNCloStHWhtZ1/HLPr2GWvGYOY4y2vg00fLldMg9M2mHCSlahvsBpFIV24w/F/3GfKvdKED2sPRiwKje7WGv7qnTjW8tf7iA==

build:
  ci:
    - export DOCKER_IMAGE_NAME=ykrevnyi/retryer.js
    - if [ "$IS_RELEASE" == false ]; then export DOCKER_TAG=trunk-${COMMIT:0:7}; fi
    - if [ "$IS_RELEASE" == true ]; then export DOCKER_TAG=${GIT_TAG_NAME#v}; fi
    - ./ci/build.sh
    - ./ci/test.sh

  post_ci:
    - ./ci/publish.sh

integrations:
  hub:
    - integrationName: personal_dockerhub
      type: docker

branches:
  only:
    - master
    - v*
