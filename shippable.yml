language: node_js

node_js:
  - 4.2.3

env:
  global:
    - secure: ptS8y1nt1FaIi4Fqggbz3qrlW7OcldDL7t4GDEjsqRTss2vX9Pr5+9FRuaef9gbcXLhpGpATVppu7ryWB9o7IVmW8cPuf5sY1C+iy8o6Z0tuUKL+zH0szd5c2onGlUZtS5h4uDjqfLfUBAvqY07lVztGSKYvJovclqyM9YJS0m+TXf19f2T5RljX6n01DBqKaEYhYUDEdRCfH6c8rQxFyrG42/DoRdcHSn6OvN0ZICJaxMj+UyI/3m8EDxmTMdgjf4ZEq0Ug5JgMKNT5P8zSowv8Ld7sfnXXfh0CFfjF2md9jlXt8mg0Nq3SUziCvV7mRNCm4owP6OmCQhKiWitcfg==
    - secure: CwimfCH/eT55L/mMPp/mSAmTKf9JdLB4fdN9QtA1FT8KX+lxarkvaIojNzkGQKcUdm6wxiQ6F7L3gvfw7OQ2IJ9kqChY8JCg50dzFQoBeDerbePR1c+Wt19GORnnHvZCytHkMd5K2xUI1PcvKquvfBoPMZbGJRpmG7TsHM6Glhge7xhGkS7B8kqmY7t71jdANGTN3PgFpWK5SCQk6mB9M2C2akhWEzk9LiZdkC633x3hV0RooNlSRlGNCloStHWhtZ1/HLPr2GWvGYOY4y2vg00fLldMg9M2mHCSlahvsBpFIV24w/F/3GfKvdKED2sPRiwKje7WGv7qnTjW8tf7iA==

build:
  ci:
    - export DOCKER_IMAGE_NAME=ykrevnyi/retryer.js
    - if [ "$IS_RELEASE" == false ]; then export DOCKER_TAG=trunk-${COMMIT:0:7}; fi
    - if [ "$IS_RELEASE" == true ]; then export DOCKER_TAG=${GIT_TAG_NAME#v}; fi
    - ./ci/build.sh
    - ./ci/test.sh

  post_ci:
    - ./ci/publish.sh

integrations:
  hub:
    - integrationName: personal_dockerhub
      type: docker

branches:
  only:
    - master
    - v*
